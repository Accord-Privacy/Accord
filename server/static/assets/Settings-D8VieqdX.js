import{r as a,n as D,a as N,j as e,v as fe,b as Qe,C as E,A as Je,s as je,c as k,l as qe,f as We}from"./index-BAF5kJbA.js";import{g as _e}from"./vendor-react-j2mp3VYR.js";import{r as Ge,a as Ye}from"./vendor-qr-D-XLueNl.js";var Xe=Ge();const Ze=_e(Xe);var Ue=Ye();const et=_e(Ue),Ne={displayName:"",bio:"",status:"online"},ke={theme:"dark",fontSize:15,messageDensity:"comfortable"},Se={inputDevice:"default",outputDevice:"default",inputVolume:100,outputVolume:100,vadSensitivity:50,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},Ce={readReceipts:!0,typingIndicators:!0,blockedUsers:[]},it=({isOpen:_,onClose:B,currentUser:i,onUserUpdate:f,serverInfo:n})=>{const[p,y]=a.useState("account"),[u,V]=a.useState(Ne),[g,Y]=a.useState(ke),[S,X]=a.useState(D.getPreferences()),[r,Z]=a.useState(Se),[x,U]=a.useState(Ce),[we,Re]=a.useState([]),[Pe,Ae]=a.useState([]),[ee,te]=a.useState(""),[De,w]=a.useState(!1),[se,ae]=a.useState(!1),[H,b]=a.useState(""),[T,ie]=a.useState(""),[ne,z]=a.useState(!1);a.useEffect(()=>{_&&((()=>{try{const s=localStorage.getItem("accord_account_settings");s?V({...Ne,...JSON.parse(s)}):i&&V({displayName:i.displayName||i.display_name||i.username||i.public_key_hash.slice(0,16),bio:i.bio||"",status:i.status||"online"});const l=localStorage.getItem("accord_appearance_settings");if(l){const o=JSON.parse(l);if(typeof o.fontSize=="string"){const h={small:13,medium:15,large:17};o.fontSize=h[o.fontSize]||15}o.compactMode!==void 0&&!o.messageDensity&&(o.messageDensity=o.compactMode?"compact":"comfortable",delete o.compactMode),Y({...ke,...o})}const c=localStorage.getItem("accord_voice_settings");c&&Z({...Se,...JSON.parse(c)});const d=localStorage.getItem("accord_privacy_settings");d&&U({...Ce,...JSON.parse(d)}),X(D.getPreferences())}catch(s){console.error("Error loading settings:",s)}})(),le(),w(!1),b(""),z(!1))},[_,i]),a.useEffect(()=>{Te(g)},[g]);const le=a.useCallback(async()=>{try{const t=await navigator.mediaDevices.enumerateDevices();Re(t.filter(s=>s.kind==="audioinput")),Ae(t.filter(s=>s.kind==="audiooutput")),te("")}catch(t){te("Failed to load audio devices"),console.error("Error loading media devices:",t)}},[]),O=a.useCallback(t=>{V(t),w(!0),b("")},[]),Ee=a.useCallback(async()=>{ae(!0),b("");try{const t=localStorage.getItem("accord_token")||(i?localStorage.getItem(`accord_token_${N.getBaseUrl().replace(/https?:\/\//,"")}`):null);t&&await N.updateProfile({display_name:u.displayName,bio:u.bio},t),localStorage.setItem("accord_account_settings",JSON.stringify(u)),f==null||f(u),w(!1),b("Profile saved!")}catch(t){console.error("Failed to save profile:",t),localStorage.setItem("accord_account_settings",JSON.stringify(u)),f==null||f(u),w(!1),b("Saved locally (server sync failed)")}finally{ae(!1)}},[u,i,f]),$=a.useCallback(t=>{localStorage.setItem("accord_appearance_settings",JSON.stringify(t)),Y(t)},[]),v=a.useCallback(t=>{localStorage.setItem("accord_voice_settings",JSON.stringify(t)),Z(t)},[]),K=a.useCallback(t=>{localStorage.setItem("accord_privacy_settings",JSON.stringify(t)),U(t)},[]),Q=a.useCallback(t=>{D.updatePreferences(t),X(t)},[]),Te=t=>{const s=document.documentElement;t.theme==="light"?(s.style.setProperty("--bg-primary","#ffffff"),s.style.setProperty("--bg-secondary","#f6f6f6"),s.style.setProperty("--bg-tertiary","#e3e5e8"),s.style.setProperty("--text-primary","#2e3338"),s.style.setProperty("--text-secondary","#747f8d")):(s.style.setProperty("--bg-primary","#36393f"),s.style.setProperty("--bg-secondary","#2f3136"),s.style.setProperty("--bg-tertiary","#202225"),s.style.setProperty("--text-primary","#dcddde"),s.style.setProperty("--text-secondary","#8e9297")),s.style.setProperty("--font-size",`${t.fontSize}px`),localStorage.setItem("accord_font_size",String(t.fontSize));const l={compact:"2px",comfortable:"8px",cozy:"16px"};s.style.setProperty("--message-spacing",l[t.messageDensity]),localStorage.setItem("accord_message_density",t.messageDensity),document.body.className=`theme-${t.theme} density-${t.messageDensity}`};a.useEffect(()=>{const t=s=>{_&&s.key==="Escape"&&B()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[_,B]);const ze=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});setTimeout(()=>{t.getTracks().forEach(s=>s.stop()),alert("Microphone test completed!")},2e3)}catch(t){alert("Microphone test failed: "+t)}},$e=()=>{const t=new(window.AudioContext||window.webkitAudioContext),s=t.createOscillator(),l=t.createGain();s.connect(l),l.connect(t.destination),s.frequency.setValueAtTime(440,t.currentTime),l.gain.setValueAtTime(r.outputVolume/100*.1,t.currentTime),s.start(),s.stop(t.currentTime+.5)},[ce,oe]=a.useState(""),[re,j]=a.useState(""),[I,M]=a.useState(null),[F,J]=a.useState(""),[de,q]=a.useState(!1),pe=a.useRef(null),[Ie,W]=a.useState(!1),[Me,Fe]=a.useState(""),[Le,G]=a.useState(!1),[he,C]=a.useState(""),ue=a.useRef(null),ge=a.useRef(null),R=a.useRef(null),P=a.useRef(0),Be=()=>{const s=((i==null?void 0:i.public_key_hash)||"").substring(0,16);if(!s){alert("No identity found to export.");return}const l=localStorage.getItem(`accord_private_key_${s}`),c=localStorage.getItem(`accord_public_key_${s}`),d=l||localStorage.getItem("accord_private_key"),o=c||localStorage.getItem("accord_public_key");if(!d||!o){alert("Could not find encrypted keys in storage. Cannot export.");return}const h=JSON.stringify({version:1,public_key:o,encrypted_private_key:d,public_key_hash:s},null,2),m=new Blob([h],{type:"application/json"}),ve=URL.createObjectURL(m),A=document.createElement("a");A.href=ve,A.download=`accord-identity-${s}.json`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(ve)},Ve=t=>{var c;j(""),oe("");const s=(c=t.target.files)==null?void 0:c[0];if(!s)return;const l=new FileReader;l.onload=d=>{var o;try{const h=JSON.parse((o=d.target)==null?void 0:o.result);if(!h.version||!h.public_key||!h.encrypted_private_key||!h.public_key_hash){j("Invalid identity file: missing required fields (version, public_key, encrypted_private_key, public_key_hash).");return}if(h.version!==1){j(`Unsupported identity file version: ${h.version}`);return}M({hash16:h.public_key_hash,encPrivKey:h.encrypted_private_key,pubKeyB64:h.public_key})}catch{j("Failed to parse identity file. Must be valid JSON.")}},l.readAsText(s),t.target.value=""},me=async()=>{if(!(!I||!F)){q(!0),j("");try{const{hash16:t,encPrivKey:s,pubKeyB64:l}=I;if(localStorage.setItem(`accord_private_key_${t}`,s),localStorage.setItem(`accord_public_key_${t}`,l),localStorage.setItem("accord_private_key",s),localStorage.setItem("accord_public_key",l),!await qe(F,t)){j("Incorrect password â€” could not decrypt the private key."),q(!1);return}We(t),M(null),J(""),oe("Identity imported successfully! Reloading..."),setTimeout(()=>window.location.reload(),1200)}catch(t){j(`Import failed: ${t.message||"unknown error"}`)}finally{q(!1)}}},He=async()=>{const s=((i==null?void 0:i.public_key_hash)||"").substring(0,16);if(!s){alert("No identity found.");return}const l=localStorage.getItem(`accord_private_key_${s}`)||localStorage.getItem("accord_private_key"),c=localStorage.getItem(`accord_public_key_${s}`)||localStorage.getItem("accord_public_key");if(!l||!c){alert("Could not find keys in storage.");return}const d=JSON.stringify({version:1,public_key:c,encrypted_private_key:l,public_key_hash:s});try{const o=await Ze.toDataURL(d,{errorCorrectionLevel:"L",width:300,margin:2});Fe(o),W(!0)}catch{alert("Failed to generate QR code â€” identity data may be too large.")}},L=a.useCallback(()=>{P.current&&(cancelAnimationFrame(P.current),P.current=0),R.current&&(R.current.getTracks().forEach(t=>t.stop()),R.current=null)},[]),Oe=async()=>{C(""),G(!0);try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});R.current=t;const s=ue.current;if(!s){L();return}s.srcObject=t,s.setAttribute("playsinline","true"),await s.play();const l=ge.current;if(!l)return;const c=l.getContext("2d",{willReadFrequently:!0});if(!c)return;const d=()=>{if(R.current){if(s.readyState===s.HAVE_ENOUGH_DATA){l.width=s.videoWidth,l.height=s.videoHeight,c.drawImage(s,0,0);const o=c.getImageData(0,0,l.width,l.height),h=et(o.data,o.width,o.height);if(h)try{const m=JSON.parse(h.data);if(!m.version||!m.public_key||!m.encrypted_private_key||!m.public_key_hash)C("Invalid QR code: missing required identity fields.");else if(m.version!==1)C(`Unsupported identity version: ${m.version}`);else{L(),G(!1),M({hash16:m.public_key_hash,encPrivKey:m.encrypted_private_key,pubKeyB64:m.public_key});return}}catch{C("QR code does not contain valid identity JSON.")}}P.current=requestAnimationFrame(d)}};P.current=requestAnimationFrame(d)}catch{C("Camera access denied. Please use file import instead.")}},ye=a.useCallback(()=>{L(),G(!1),C("")},[L]),xe=()=>{if(!ne){z(!0);return}const t=[];for(let s=0;s<localStorage.length;s++){const l=localStorage.key(s);l&&l.startsWith("accord_")&&t.push(l)}t.forEach(s=>localStorage.removeItem(s)),z(!1),alert("Local data cleared. Please refresh the app."),window.location.reload()},be=()=>{if(!T.trim())return;let t=T.trim();!t.startsWith("http://")&&!t.startsWith("https://")&&(t="http://"+t),N.setBaseUrl(t),alert(`Relay URL set to ${t}. You may need to re-authenticate.`),ie("")},Ke=t=>t.slice(0,32).replace(/(.{4})/g,"$1 ").trim().toUpperCase();return _?e.jsxs("div",{className:"settings-overlay",children:[e.jsxs("div",{className:"settings-modal",children:[e.jsxs("div",{className:"settings-sidebar",children:[e.jsx("div",{className:"settings-header",children:e.jsx("h2",{children:"Settings"})}),e.jsxs("nav",{className:"settings-nav",children:[e.jsx("button",{className:`settings-nav-item ${p==="account"?"active":""}`,onClick:()=>y("account"),children:"ðŸ‘¤ Profile"}),e.jsx("button",{className:`settings-nav-item ${p==="appearance"?"active":""}`,onClick:()=>y("appearance"),children:"ðŸŽ¨ Appearance"}),e.jsx("button",{className:`settings-nav-item ${p==="notifications"?"active":""}`,onClick:()=>y("notifications"),children:"ðŸ”” Notifications"}),e.jsx("button",{className:`settings-nav-item ${p==="voice"?"active":""}`,onClick:()=>y("voice"),children:"ðŸŽ¤ Voice & Audio"}),e.jsx("button",{className:`settings-nav-item ${p==="privacy"?"active":""}`,onClick:()=>y("privacy"),children:"ðŸ”’ Privacy"}),e.jsx("button",{className:`settings-nav-item ${p==="advanced"?"active":""}`,onClick:()=>y("advanced"),children:"âš™ï¸ Advanced"}),e.jsx("button",{className:`settings-nav-item ${p==="server"?"active":""}`,onClick:()=>y("server"),children:"ðŸ–¥ï¸ Server Info"}),e.jsx("button",{className:`settings-nav-item ${p==="about"?"active":""}`,onClick:()=>y("about"),children:"â„¹ï¸ About"})]})]}),e.jsxs("div",{className:"settings-content",children:[e.jsx("div",{className:"settings-content-header",children:e.jsx("button",{className:"settings-close",onClick:B,children:"Ã—"})}),e.jsxs("div",{className:"settings-panel",children:[p==="account"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Profile"}),e.jsxs("div",{className:"settings-group",style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"16px"},children:[e.jsxs("div",{onClick:()=>{const t=document.createElement("input");t.type="file",t.accept="image/png,image/jpeg,image/gif,image/webp",t.onchange=async s=>{var c;const l=(c=s.target.files)==null?void 0:c[0];if(l){if(l.size>256*1024){b("Avatar must be under 256KB");return}try{const d=localStorage.getItem("accord_auth_token")||"";await N.uploadUserAvatar(l,d),b("Avatar updated!"),w(!1)}catch(d){b(d instanceof Error?d.message:"Failed to upload avatar")}}},t.click()},style:{width:"80px",height:"80px",borderRadius:"50%",background:"#40444b",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",overflow:"hidden",fontSize:"32px",color:"#b9bbbe",flexShrink:0,position:"relative"},title:"Click to upload avatar",children:[i!=null&&i.id?e.jsx("img",{src:`${N.getUserAvatarUrl(i.id)}?t=${Date.now()}`,alt:((i==null?void 0:i.display_name)||"U")[0],style:{width:"100%",height:"100%",objectFit:"cover"},onError:t=>{t.target.style.display="none",t.target.parentElement.textContent=((i==null?void 0:i.display_name)||"U")[0]}}):((i==null?void 0:i.display_name)||"U")[0],e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0,0,0,0.6)",fontSize:"10px",textAlign:"center",padding:"2px",color:"#fff"},children:"EDIT"})]}),e.jsx("div",{style:{color:"#b9bbbe",fontSize:"13px"},children:"Click to upload avatar (PNG, JPEG, GIF, WebP â€” max 256KB)"})]}),(i==null?void 0:i.public_key_hash)&&e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Public Key Fingerprint"}),e.jsx("div",{className:"settings-info",style:{fontFamily:"var(--font-mono)",fontSize:13,letterSpacing:"0.05em"},children:Ke(i.public_key_hash)})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Display Name"}),e.jsx("input",{type:"text",className:"settings-input",value:u.displayName,onChange:t=>O({...u,displayName:t.target.value}),placeholder:"Enter display name..."})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Bio"}),e.jsx("textarea",{className:"settings-textarea",value:u.bio,onChange:t=>O({...u,bio:t.target.value}),placeholder:"Tell others about yourself...",rows:3})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Status"}),e.jsx("div",{className:"status-buttons",children:["online","away","busy","invisible"].map(t=>e.jsxs("button",{className:`status-button ${u.status===t?"active":""}`,onClick:()=>O({...u,status:t}),children:[e.jsx("div",{className:`status-indicator ${t}`}),t.charAt(0).toUpperCase()+t.slice(1)]},t))})]}),e.jsxs("div",{className:"settings-group",style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"btn btn-primary",style:{width:"auto",padding:"10px 24px"},disabled:!De||se,onClick:Ee,children:se?"Saving...":"Save Profile"}),H&&e.jsx("span",{style:{fontSize:13,color:H.includes("failed")?"var(--yellow)":"var(--green)"},children:H})]}),e.jsx("div",{className:"settings-group",children:e.jsxs("div",{className:"settings-info",children:[e.jsx("strong",{children:"User ID:"})," ",(i==null?void 0:i.id)||"Unknown"]})})]}),p==="appearance"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Appearance"}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Theme"}),e.jsxs("div",{className:"theme-buttons",children:[e.jsx("button",{className:`theme-button dark ${g.theme==="dark"?"active":""}`,onClick:()=>$({...g,theme:"dark"}),children:"ðŸŒ™ Dark"}),e.jsx("button",{className:`theme-button light ${g.theme==="light"?"active":""}`,onClick:()=>$({...g,theme:"light"}),children:"â˜€ï¸ Light"})]}),e.jsx("div",{className:"settings-help",children:"Light theme is experimental and may not look perfect everywhere."})]}),e.jsxs("div",{className:"settings-group",children:[e.jsxs("label",{className:"settings-label",children:["Font Size: ",g.fontSize,"px"]}),e.jsx("input",{type:"range",className:"settings-slider",min:"12",max:"20",step:"1",value:g.fontSize,onChange:t=>$({...g,fontSize:parseInt(t.target.value)})}),e.jsxs("div",{className:"settings-help",style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"12px"}),e.jsx("span",{children:"20px"})]})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Message Density"}),e.jsx("div",{className:"font-size-buttons",children:["compact","comfortable","cozy"].map(t=>e.jsx("button",{className:`font-size-button ${g.messageDensity===t?"active":""}`,onClick:()=>$({...g,messageDensity:t}),children:t.charAt(0).toUpperCase()+t.slice(1)},t))}),e.jsx("div",{className:"settings-help",children:"Controls spacing between messages. Compact shows more messages on screen."})]})]}),p==="notifications"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:S.enabled,onChange:t=>Q({...S,enabled:t.target.checked})}),e.jsx("span",{className:"checkmark"}),"Enable Desktop Notifications"]})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Notification Mode"}),e.jsx("div",{className:"notification-mode-buttons",children:["all","mentions","none"].map(t=>e.jsx("button",{className:`notification-button ${S.mode===t?"active":""}`,onClick:()=>Q({...S,mode:t}),children:t==="all"?"All Messages":t==="mentions"?"Mentions Only":"None"},t))})]}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:S.sounds,onChange:t=>Q({...S,sounds:t.target.checked})}),e.jsx("span",{className:"checkmark"}),"Sound Notifications"]})}),e.jsx("div",{className:"settings-group",children:e.jsxs("div",{className:"test-buttons",children:[e.jsx("button",{className:"test-button",onClick:()=>{"Notification"in window&&Notification.permission==="granted"?new Notification("Test Notification",{body:"This is a test notification from Accord!",icon:"/favicon.ico"}):Notification.requestPermission().then(t=>{t==="granted"&&new Notification("Test Notification",{body:"This is a test notification from Accord!",icon:"/favicon.ico"})})},children:"Test Notification"}),e.jsx("button",{className:"test-button",onClick:()=>{var t,s;return(s=(t=D).playNotificationSound)==null?void 0:s.call(t)},children:"Test Sound"}),e.jsx("button",{className:"clear-button",onClick:()=>{D.clearAllUnreads(),alert("All unread counts cleared")},children:"Clear All Unreads"})]})})]}),p==="voice"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Voice & Audio Settings"}),ee&&e.jsx("div",{className:"settings-error",children:ee}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-label",children:["Input Device",e.jsxs("select",{className:"settings-select",value:r.inputDevice,onChange:t=>v({...r,inputDevice:t.target.value}),children:[e.jsx("option",{value:"default",children:"Default"}),we.map(t=>e.jsx("option",{value:t.deviceId,children:t.label||`Microphone ${t.deviceId.slice(0,8)}...`},t.deviceId))]})]})}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-label",children:["Output Device",e.jsxs("select",{className:"settings-select",value:r.outputDevice,onChange:t=>v({...r,outputDevice:t.target.value}),children:[e.jsx("option",{value:"default",children:"Default"}),Pe.map(t=>e.jsx("option",{value:t.deviceId,children:t.label||`Speaker ${t.deviceId.slice(0,8)}...`},t.deviceId))]})]})}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-label",children:["Input Volume: ",r.inputVolume,"%",e.jsx("input",{type:"range",className:"settings-slider",min:"0",max:"100",value:r.inputVolume,onChange:t=>v({...r,inputVolume:parseInt(t.target.value)})})]})}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-label",children:["Output Volume: ",r.outputVolume,"%",e.jsx("input",{type:"range",className:"settings-slider",min:"0",max:"100",value:r.outputVolume,onChange:t=>v({...r,outputVolume:parseInt(t.target.value)})})]})}),e.jsxs("div",{className:"settings-group",children:[e.jsxs("label",{className:"settings-label",children:["Voice Activity Sensitivity: ",r.vadSensitivity,"%",e.jsx("input",{type:"range",className:"settings-slider",min:"0",max:"100",value:r.vadSensitivity,onChange:t=>v({...r,vadSensitivity:parseInt(t.target.value)})})]}),e.jsx("div",{className:"settings-help",children:"Higher values require louder audio to trigger voice activation."})]}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:r.echoCancellation,onChange:t=>v({...r,echoCancellation:t.target.checked})}),e.jsx("span",{className:"checkmark"}),"Echo Cancellation"]})}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:r.noiseSuppression,onChange:t=>v({...r,noiseSuppression:t.target.checked})}),e.jsx("span",{className:"checkmark"}),"Noise Suppression"]})}),e.jsx("div",{className:"settings-group",children:e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:r.autoGainControl,onChange:t=>v({...r,autoGainControl:t.target.checked})}),e.jsx("span",{className:"checkmark"}),"Automatic Gain Control"]})}),e.jsx("div",{className:"settings-group",children:e.jsxs("div",{className:"test-buttons",children:[e.jsx("button",{className:"test-button",onClick:ze,children:"Test Microphone"}),e.jsx("button",{className:"test-button",onClick:$e,children:"Test Speakers"}),e.jsx("button",{className:"refresh-button",onClick:le,children:"Refresh Devices"})]})})]}),p==="privacy"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Privacy Settings"}),e.jsxs("div",{className:"settings-group",children:[e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:x.readReceipts,onChange:t=>K({...x,readReceipts:t.target.checked})}),e.jsx("span",{className:"checkmark"}),"Send Read Receipts"]}),e.jsx("div",{className:"settings-help",children:"Let others know when you've read their messages."})]}),e.jsxs("div",{className:"settings-group",children:[e.jsxs("label",{className:"settings-checkbox",children:[e.jsx("input",{type:"checkbox",checked:x.typingIndicators,onChange:t=>K({...x,typingIndicators:t.target.checked})}),e.jsx("span",{className:"checkmark"}),"Show Typing Indicators"]}),e.jsx("div",{className:"settings-help",children:"Show when you're typing to other users."})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Block List"}),e.jsx("div",{className:"blocked-users",children:x.blockedUsers.length===0?e.jsx("div",{className:"settings-help",children:"No blocked users"}):x.blockedUsers.map(t=>e.jsxs("div",{className:"blocked-user",children:[e.jsx("span",{children:t}),e.jsx("button",{className:"unblock-button",onClick:()=>K({...x,blockedUsers:x.blockedUsers.filter(s=>s!==t)}),children:"Unblock"})]},t))})]})]}),p==="advanced"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Advanced"}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Current Relay URL"}),e.jsx("div",{className:"settings-info",style:{fontFamily:"var(--font-mono)",fontSize:13},children:N.getBaseUrl()})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Connect to Relay Manually"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("input",{type:"text",className:"settings-input",value:T,onChange:t=>ie(t.target.value),placeholder:"e.g. 192.168.1.100:8080",onKeyDown:t=>{t.key==="Enter"&&be()}}),e.jsx("button",{className:"btn btn-primary",style:{width:"auto",padding:"10px 16px",whiteSpace:"nowrap"},onClick:be,disabled:!T.trim(),children:"Connect"})]}),e.jsx("div",{className:"settings-help",children:"Enter a relay server address to connect to a different server."})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Identity Key Management"}),e.jsxs("div",{className:"test-buttons",style:{flexWrap:"wrap"},children:[e.jsx("button",{className:"test-button",onClick:Be,children:"ðŸ“¤ Export Identity"}),e.jsx("button",{className:"test-button",onClick:He,children:"ðŸ“± Show QR Code"}),e.jsx("button",{className:"test-button",onClick:()=>{var t;return(t=pe.current)==null?void 0:t.click()},children:"ðŸ“¥ Import Identity"}),e.jsx("button",{className:"test-button",onClick:Oe,children:"ðŸ“· Scan QR Code"}),e.jsx("input",{ref:pe,type:"file",accept:".json",style:{display:"none"},onChange:Ve})]}),e.jsx("div",{className:"settings-help",children:"Export your encrypted identity to a JSON file for backup or transfer to another browser. Import a previously exported identity file to restore access."}),ce&&e.jsx("div",{className:"auth-success",style:{marginTop:8},children:ce}),re&&e.jsx("div",{style:{color:"var(--red, #f44)",marginTop:8,fontSize:13},children:re}),I&&e.jsxs("div",{style:{marginTop:12,padding:12,background:"var(--bg-tertiary)",borderRadius:8},children:[e.jsxs("div",{style:{marginBottom:8,fontSize:14},children:["Enter password to decrypt identity ",e.jsx("code",{children:I.hash16}),":"]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"password",placeholder:"Password",value:F,onChange:t=>J(t.target.value),onKeyDown:t=>{t.key==="Enter"&&me()},className:"form-input",style:{flex:1},autoFocus:!0}),e.jsx("button",{className:"test-button",onClick:me,disabled:de||!F,children:de?"Verifying...":"Confirm"}),e.jsx("button",{className:"test-button",onClick:()=>{M(null),J("")},children:"Cancel"})]})]})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Clear Local Data"}),ne?e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("button",{className:"clear-button",onClick:xe,children:"Confirm â€” Delete Everything"}),e.jsx("button",{className:"test-button",onClick:()=>z(!1),children:"Cancel"})]}):e.jsx("button",{className:"clear-button",onClick:xe,children:"ðŸ—‘ï¸ Clear Local Data"}),e.jsx("div",{className:"settings-help",children:"Removes all locally stored settings, keys, and tokens. This cannot be undone."})]})]}),p==="server"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Server Info"}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Connection Status"}),e.jsx("div",{className:"settings-info",children:n!=null&&n.isConnected?"ðŸŸ¢ Connected":"ðŸ”´ Disconnected"})]}),(n==null?void 0:n.version)&&e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Server Version"}),e.jsx("div",{className:"settings-info",children:n.version})]}),(n==null?void 0:n.buildHash)&&e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Server Build Hash"}),e.jsxs("div",{className:"settings-info copyable",style:{fontFamily:"var(--font-mono)",fontSize:13,cursor:"pointer"},title:"Click to copy",onClick:()=>{navigator.clipboard.writeText(n.buildHash)},children:[n.buildHash," ðŸ“‹"]})]}),(n==null?void 0:n.connectedSince)&&e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Connected Since"}),e.jsx("div",{className:"settings-info",children:new Date(n.connectedSince).toLocaleString()})]}),e.jsxs("div",{className:"settings-group",children:[e.jsx("label",{className:"settings-label",children:"Relay Address"}),e.jsx("div",{className:"settings-info",style:{fontFamily:"var(--font-mono)",fontSize:13},children:(n==null?void 0:n.relayAddress)||N.getBaseUrl()})]})]}),p==="about"&&(()=>{const t=fe(E),s=n!=null&&n.buildHash?fe(n.buildHash):null,l=n!=null&&n.buildHash?Qe(E,n.buildHash):t,c=k(l);return e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"About Accord"}),e.jsxs("div",{className:"about-content",children:[e.jsxs("div",{className:"about-logo",children:[e.jsx("div",{className:"app-icon",children:"A"}),e.jsx("h2",{children:"Accord"})]}),e.jsxs("div",{className:"about-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("strong",{children:"Version:"})," ",Je]}),e.jsxs("div",{className:"info-row",children:[e.jsx("strong",{children:"Protocol:"})," Accord Protocol v1"]}),e.jsxs("div",{className:"info-row",children:[e.jsx("strong",{children:"Platform:"})," Desktop (Tauri + React)"]})]}),e.jsxs("div",{className:"about-build-hashes",style:{margin:"16px 0",padding:"12px",background:"var(--bg-tertiary)",borderRadius:"8px"},children:[e.jsx("h4",{style:{margin:"0 0 12px 0",fontSize:"14px"},children:"Build Verification"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",padding:"8px 12px",borderRadius:"6px",background:`${c.color}15`,border:`1px solid ${c.color}40`},children:[e.jsx("span",{style:{fontSize:"18px"},children:c.emoji}),e.jsx("span",{style:{fontWeight:600,color:c.color},children:c.label})]}),e.jsxs("div",{className:"info-row",style:{marginBottom:"6px"},children:[e.jsx("strong",{children:"Client Build:"})," ",e.jsx("code",{style:{fontFamily:"var(--font-mono)",fontSize:"12px",cursor:"pointer",background:"var(--bg-secondary)",padding:"2px 6px",borderRadius:"3px"},title:`Full hash: ${E}
Click to copy`,onClick:()=>navigator.clipboard.writeText(E),children:je(E)}),e.jsxs("span",{style:{marginLeft:"6px",fontSize:"11px",color:k(t).color},children:[k(t).emoji," ",k(t).label]})]}),e.jsxs("div",{className:"info-row",style:{marginBottom:"6px"},children:[e.jsx("strong",{children:"Server Build:"})," ",n!=null&&n.buildHash?e.jsxs(e.Fragment,{children:[e.jsx("code",{style:{fontFamily:"var(--font-mono)",fontSize:"12px",cursor:"pointer",background:"var(--bg-secondary)",padding:"2px 6px",borderRadius:"3px"},title:`Full hash: ${n.buildHash}
Click to copy`,onClick:()=>navigator.clipboard.writeText(n.buildHash),children:je(n.buildHash)}),s&&e.jsxs("span",{style:{marginLeft:"6px",fontSize:"11px",color:k(s).color},children:[k(s).emoji," ",k(s).label]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"13px"},children:n!=null&&n.isConnected?"Not reported":"Not connected"})]}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"8px"},children:"Build hashes verify that client and server code hasn't been tampered with. Official releases are signed and verified against a known hash registry."})]}),e.jsx("div",{className:"about-description",children:e.jsx("p",{children:"Accord is an open-source, privacy-first chat application with end-to-end encryption. Your keys, your data, your control."})}),e.jsxs("div",{className:"about-links",children:[e.jsx("a",{href:"https://github.com/nicholasgasior/accord",target:"_blank",rel:"noopener noreferrer",children:"ðŸ“– Source Code on GitHub"}),e.jsx("a",{href:"https://github.com/nicholasgasior/accord/issues",target:"_blank",rel:"noopener noreferrer",children:"ðŸ› Report a Bug"}),e.jsx("a",{href:"https://github.com/nicholasgasior/accord/blob/main/LICENSE",target:"_blank",rel:"noopener noreferrer",children:"ðŸ“„ License (MIT)"})]}),e.jsxs("div",{className:"about-credits",children:[e.jsx("h4",{children:"Built with â¤ï¸ by the Accord team"}),e.jsx("p",{children:"Special thanks to all contributors and the open-source community."})]})]})]})})()]})]})]}),Ie&&e.jsx("div",{className:"settings-overlay",style:{zIndex:10001},onClick:()=>W(!1),children:e.jsxs("div",{style:{background:"var(--bg-secondary, #2f3136)",borderRadius:12,padding:24,maxWidth:360,textAlign:"center"},onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{margin:"0 0 12px",color:"var(--text-primary)"},children:"Identity QR Code"}),e.jsx("img",{src:Me,alt:"Identity QR Code",style:{width:280,height:280,borderRadius:8,background:"#fff",padding:8}}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:13,margin:"12px 0 4px"},children:"Scan this QR code on your other device to sync your identity."}),e.jsx("p",{style:{color:"#f0a030",fontSize:12,margin:"4px 0 12px"},children:"âš ï¸ This QR code contains your encrypted identity. Only share with your own devices."}),e.jsx("button",{className:"btn btn-primary",style:{width:"auto",padding:"8px 24px"},onClick:()=>W(!1),children:"Close"})]})}),Le&&e.jsx("div",{className:"settings-overlay",style:{zIndex:10001},onClick:ye,children:e.jsxs("div",{style:{background:"var(--bg-secondary, #2f3136)",borderRadius:12,padding:24,maxWidth:400,textAlign:"center"},onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{margin:"0 0 12px",color:"var(--text-primary)"},children:"Scan Identity QR Code"}),he?e.jsxs("div",{children:[e.jsx("p",{style:{color:"#f44",fontSize:14,margin:"16px 0"},children:he}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:13},children:"You can use file import as an alternative."})]}):e.jsxs("div",{style:{position:"relative"},children:[e.jsx("video",{ref:ue,style:{width:"100%",maxWidth:340,borderRadius:8,background:"#000"},muted:!0,playsInline:!0}),e.jsx("canvas",{ref:ge,style:{display:"none"}}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:13,marginTop:8},children:"Point your camera at an Accord identity QR code."})]}),e.jsx("button",{className:"btn btn-primary",style:{width:"auto",padding:"8px 24px",marginTop:12},onClick:ye,children:"Cancel"})]})})]}):null};export{it as Settings};
